<!DOCTYPE html>
<html lang="PT-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caminhões</title>

    <script src="../../js/funcao.js"></script>

    <link rel="icon" type="imagem/ico" sizes="192x192" href="../img/favicon.ico" />

    <!--links pages-->

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/modal_form.css">


    <!-- chart js-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <!--Material CDN-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <style>
        /* Dark theme  */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #181a1e;
                --color-white: #202528;
                --color-dark: #edeffd;
                --color-dark-variant: #a3bdcc;
                --color-light: rgba(0, 0, 0, 0.4);
                --box-shadow: 0 2rem 3rem var(--color-light);
            }
        }
    </style>

</head>

<body onload="validarSessao(), select_caminhao()">

    <!--side bar-->
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <h2>SEAL<span style="color: var(--color-primary);"> SOLUTION</span></h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">close</span>
                </div>
            </div>
            <div class="sidebar">
                <a href="../index.html" class="active">
                    <span class="material-icons-sharp">grid_view</span>
                    <h3>GRÁFICOS</h3>
                </a>
                <a href="../telas/empresa.html" class="active">
                    <span class="material-icons-sharp">business</span>
                    <h3>EMPRESA</h3>
                </a>
                <a href="../telas/funcionario.html" class="active">
                    <span class="material-icons-sharp">person_outline</span>
                    <h3>USÚARIOS</h3>
                </a>
                <a href="../telas/Caminhao.html" class="active">
                    <span class="material-icons-sharp">local_shipping</span>
                    <h3>CAMINHÕES</h3>
                    <span class="message-count">3</span>
                </a>

                <a href="../telas/help.html" class="active">
                    <span class="material-icons-sharp">help</span>
                    <h3>CANAL DE AJUDA</h3>
                </a>
                <a href="../telas/tomates.html" class="active">
                    <span class="material-symbols-outlined"> nutrition </span>
                    <h3>TOMATES</h3>
                </a>
                <a href="../telas/motorista.html" class="active">
                    <span class="material-icons-sharp">sports_motorsports</span>
                    <h3>MOTORISTA</h3>
                </a>
                <a onclick="limparSessao_telas()" class="active">
                    <span class="material-icons-sharp">logout</span>
                    <h3>DESLOGAR</h3>
                </a>
            </div>
        </aside>

        <!---------------- end aside ---------------->

        <main>
            <div class="recent-orders">
                <h2>CAMINHÕES CADASTRADOS</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Marca</th>
                            <th>placa</th>
                            <th>Tipo Caminhão</th>
                            <th>Sensor</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="mostrar">
                    </tbody>
                </table>
                <a href="#cadastro_caminhao">CADASTRAR CAMINHÃO</a>
            </div>
        </main>

        <!----------- end main ------------->

        <div class="right">
            <div class="top">
                <button id="menu-btn">
                    <span class="material-icons-sharp">menu</span>
                </button>
                <div class="profile">
                    <div class="info">
                        <p>OLÁ, <b id="b_usuario"></b></p>
                    </div>
                    <div class="profile-photo"><a href="../telas/dadosUser.html">
                            <img src="../img/img1.jpg"></a>
                    </div>
                </div>
            </div>
            <!--end top-->
        </div>
    </div>


    <!-- Modal -->
    <div class="modal-wrapper modal" id="cadastro_caminhao">
        <div class="modal-body card_modal">
            <div class="modal-header">
                <h2 class="heading">Dados do Caminhão</h2>
                <a href="#!" role="button" class="close" aria-label="close this modal">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z" />
                    </svg>
                </a>
            </div>
            <section class="input-content">
                <div class="input-content-wrap">
                    <dl class="inputbox">
                        <dt class="inputbox-title">Placa</dt>
                        <dd class="inputbox-content">
                            <input id="ipt_Placa" type="text" placeholder="Placa do veículo" />
                            <span class="underline"></span>
                        </dd>
                    </dl>
                    <dl class="inputbox">
                        <dt class="inputbox-title">Marca</dt>
                        <dd class="inputbox-content">
                            <input id="ipt_Marca" type="text" placeholder="Marca do veículo" />
                            <span class="underline"></span>
                        </dd>
                    </dl>
                    <dl class="inputbox">
                        <dt class="inputbox-title">Tipo de Caminhão</dt>
                        <dd class="inputbox-content">
                            <div class="select">
                                <select id="sel_tipoCaminhao">
                                    <option value="Toco">Toco</option>
                                    <option value="Truck">Truck</option>
                                    <option value="CarretaSimples">Carreta Simples</option>
                                    <option value="CarretaEixoExtendido">Carreta Eixo Extendido</option>
                                </select>
                                <span class="focus"></span>
                            </div>
                        </dd>
                    </dl>
                    <dl class="inputbox">
                        <dt class="inputbox-title">Sensores</dt>
                        <dd class="inputbox-content">
                            <div class="select">
                                <select id="sel_sensor">
                                    <option value="dht11">DHT 11</option>
                                    <option value="dht11">DHT 11</option>
                                    <option value="dht11">DHT 11</option>
                                    <option value="vazio">Vazio</option>
                                </select>
                                <span class="focus"></span>
                            </div>
                        </dd>
                    </dl>
                    <button class="btn btn-confirm" onclick="cadastrarCaminhao()">Cadastrar</button>
                </div>
            </section>
        </div>
        <a href="#!" class="outside-trigger"></a>
    </div>

    



    <script src="../js/style.js"></script>
</body>

</html>
<script>

    function cadastrarCaminhao() {
        var placaVar = ipt_Placa.value
        var marcaVar = ipt_Marca.value
        var tipoCaminhaoVar = sel_tipoCaminhao.value
        var sensorVar = sel_sensor.value
        if (placaVar == "" || marcaVar == "" || tipoCaminhaoVar == "" || sensorVar == "") {
            alert("Campos não preenchidos")
        }

        fetch("/caminhaos/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                marcaServer: marcaVar,
                placaServer: placaVar,
                tipoCaminhaoServer: tipoCaminhaoVar,
                sensorServer: sensorVar
            })

        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert("Caminhão cadastrado com sucesso!!")
                setTimeout(() => {
                    window.location = "Caminhao.html";
                }, "2000")
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
    }

</script>

<script>

    function select_caminhao() {
        fetch(`/caminhaos/plotar_caminhao`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`data recebidos: ${JSON.stringify(resposta)}`);

                    plotarFuncionario(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos data p/ gráfico: ${error.message}`);
            });
    }

    // Esta função *plotarFuncionario* usa os data capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarFuncionario* também invoca a função *atualizarGrafico*
    function plotarFuncionario(resposta) {

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];

            mostrar.innerHTML += `
                        <tr>
                            <td>${registro.marca}</td>
                            <td>${registro.placa}</td>
                            <td>${ registro.tipoCaminhao}</td>
                            <td>${registro.sensor}</td>
                            <td class="success">Ativo</td>
                        </tr>
 `
        }
    }
</script>